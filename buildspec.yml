version: 0.2

env:
  variables:
    APP_MODULE: "web"

phases:
  install:
    runtime-versions:
      java: corretto17
    commands:
      - echo "ğŸ”§ ì„¤ì¹˜ ì‹œì‘"
      - chmod +x ./gradlew
      - ./gradlew --version
      - sudo yum install -y postgresql
      - psql --version
      - echo "âœ… ì„¤ì¹˜ ì™„ë£Œ"

  rds_connection_test:
    commands:
      - echo "ğŸ“¡ RDS PostgreSQL ì—°ê²° ì‹œë„"
      - export PGPASSWORD=$BONGSCO_RDS_PASSWORD
      - psql -h $BONGSCO_RDS_ENDPOINT -U $BONGSCO_RDS_USERNAME -d $BONGSCO_RDS_DB_NAME -p 5432 -c '\q'
      - unset PGPASSWORD
      - echo "âœ… RDS PostgreSQL ì—°ê²° í™•ì¸ ì„±ê³µ"

  pre_build:
    commands:
      - echo "ğŸ“ pre_build ì‹œì‘"
      - mkdir -p $APP_MODULE/src/main/resources
      - rm -f $APP_MODULE/src/main/resources/application-dev.yml
      - echo $BONGSCO_DEV_APP_YML | base64 --decode > $APP_MODULE/src/main/resources/application-dev.yml
      - echo "âœ… pre_build ì™„ë£Œ"

  build:
    commands:
      - echo "ğŸ› ï¸ ë¹Œë“œ ì‹œì‘"
      - ./gradlew :$APP_MODULE:clean :$APP_MODULE:build
      - echo "âœ… ë¹Œë“œ ì™„ë£Œ"

  post_build:
    commands:
      - echo "ğŸš€ ë¹Œë“œ í›„ ì‘ì—… ì™„ë£Œ"